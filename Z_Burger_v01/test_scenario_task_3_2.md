# Task 3.2 모호성 처리 대화 로직 테스트 시나리오

## 테스트 목표
findProduct가 AMBIGUOUS 상태를 반환할 때, LLM이 고객에게 선택지를 명확하게 제시하고 올바르게 처리하는지 검증

---

## 시나리오 1: 양념감자 주문 (4가지 옵션)

### 대화 흐름
```
고객: "양념감자 주세요"
봇: findProduct("양념감자") 호출
   → status: "AMBIGUOUS"
   → matches: 4개 (어니언, 칠리, 치즈, 실비김치)

예상 응답:
"양념감자는 4가지 맛이 있습니다. 어떤 것으로 드릴까요?
 1. 양념감자 (어니언) - 2,600원
 2. 양념감자 (칠리) - 2,600원
 3. 양념감자 (치즈) - 2,600원
 4. 양념감자 (실비김치) - 2,600원"

고객: "칠리로 주세요"
봇: findProduct("양념감자 칠리") 또는 "칠리" 호출
   → status: "FOUND"
   → product: 양념감자 (칠리)

예상 응답:
"양념감자 (칠리) 2,600원입니다. 장바구니에 담아드릴까요?"

고객: "네"
봇: addToCart(session_id, "B00004", quantity=1) 호출
```

### 검증 포인트
- ✅ AMBIGUOUS 상태 감지
- ✅ 4가지 선택지 명확하게 제시
- ✅ 가격 정보 포함
- ✅ 고객 선택 후 정확한 상품 주문
- ✅ 장바구니에 올바른 product_id 추가

---

## 시나리오 2: 콜라 주문 (미디움/라지)

### 대화 흐름
```
고객: "콜라 주세요"
봇: findProduct("콜라") 호출
   → status: "AMBIGUOUS" (또는 FOUND, 점수 차이에 따라)
   → matches: 2개 (미디움, 라지)

예상 응답 (AMBIGUOUS인 경우):
"콜라는 2가지 사이즈가 있습니다. 어떤 것으로 드릴까요?
 1. 콜라 (미디움) - 2,000원
 2. 콜라 (라지) - 2,200원"
 3. 제로슈거콜라 (미디움) - 2,000원
 3. 제로슈거콜라 (라지) - 2,200원

고객: "미디움으로 주세요"
봇: findProduct("콜라 미디움") 호출
   → status: "FOUND"
   → product: 콜라 (미디움)

예상 응답:
"콜라 (미디움) 2,000원입니다. 장바구니에 담아드릴까요?"
```

### 검증 포인트
- ✅ 사이즈 옵션 제시
- ✅ 가격 차이 명확히 표시
- ✅ 고객 선택 반영

---

## 시나리오 3: 번호로 선택

### 대화 흐름
```
고객: "양념감자 주세요"
봇: "양념감자는 4가지 맛이 있습니다. 어떤 것으로 드릴까요?
     1. 양념감자 (어니언) - 2,600원
     2. 양념감자 (칠리) - 2,600원
     3. 양념감자 (치즈) - 2,600원
     4. 양념감자 (실비김치) - 2,600원"

고객: "2번으로 주세요"
봇: matches[1] (칠리) 선택
   → product_id: B00004

예상 응답:
"양념감자 (칠리) 2,600원입니다. 장바구니에 담아드릴까요?"
```

### 검증 포인트
- ✅ 번호 입력 처리
- ✅ 올바른 인덱스 매칭 (2번 = matches[1])
- ✅ 정확한 product_id 사용

---

## 시나리오 4: 세트 메뉴 옵션 변경 시 모호성 처리

### 대화 흐름
```
고객: "한우불고기버거 세트에서 감자튀김을 양념감자로 바꿔주세요"
봇: findProduct("한우불고기버거 세트") → G00001
    getSetComposition("G00001") → 포테이토 (미디움) 포함
    findProduct("양념감자") 호출
   → status: "AMBIGUOUS"
   → matches: 4개

예상 응답:
"양념감자는 4가지 맛이 있습니다. 어떤 맛으로 변경하시겠어요?
 1. 양념감자 (어니언) - 2,600원 (추가 600원)
 2. 양념감자 (칠리) - 2,600원 (추가 600원)
 3. 양념감자 (치즈) - 2,600원 (추가 600원)
 4. 양념감자 (실비김치) - 2,600원 (추가 600원)"

고객: "치즈로 주세요"
봇: findProduct("양념감자 치즈") 또는 matches에서 치즈 선택
    가격 차이 계산: 2600 - 2000 = 600원

예상 응답:
"양념감자 (치즈)로 변경하시면 600원이 추가됩니다. 변경하시겠습니까?"

고객: "네"
봇: addToCart(session_id, "G00001", quantity=1,
              special_requests="포테이토 → 양념감자 (치즈) 변경")
```

### 검증 포인트
- ✅ 세트 옵션 변경 맥락에서 AMBIGUOUS 처리
- ✅ 추가금 정보 포함하여 선택지 제시
- ✅ 가격 차이 계산 정확
- ✅ special_requests에 변경사항 기록

---

## 시나리오 5: 모호성 없는 경우 (FOUND)

### 대화 흐름
```
고객: "한우불고기버거 주세요"
봇: findProduct("한우불고기버거") 호출
   → status: "FOUND"
   → product: 한우불고기버거 (A00001)

예상 응답:
"한우불고기버거 9,000원입니다. 장바구니에 담아드릴까요?"
(선택지 제시 없이 바로 진행)
```

### 검증 포인트
- ✅ FOUND 상태에서는 선택지 제시 안 함
- ✅ 바로 주문 프로세스 진행

---

## 테스트 실행 방법

1. Mr_Burger.py 실행
```bash
cd C:\PROJECT\burgeria-orderbot\Z_Burger_v01
python Mr_Burger.py
```

2. 각 시나리오 순서대로 테스트

3. 체크리스트
- [ ] 시나리오 1: 양념감자 4가지 선택지 제시
- [ ] 시나리오 2: 콜라 사이즈 선택
- [ ] 시나리오 3: 번호로 선택
- [ ] 시나리오 4: 세트 옵션 변경 시 모호성 처리
- [ ] 시나리오 5: 명확한 메뉴는 바로 진행

---

## 성공 기준

✅ **모두 통과해야 Task 3.2 완료**

1. AMBIGUOUS 상태 정확히 감지
2. 선택지를 번호와 함께 명확하게 제시
3. 가격 정보 포함
4. 고객의 선택(텍스트 또는 번호) 정확히 처리
5. 최종 product_id가 올바르게 addToCart에 전달됨