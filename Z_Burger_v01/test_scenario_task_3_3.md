# Task 3.3: 장바구니 관리 함수 통합 테스트 시나리오

## 목표
사용자가 장바구니를 조회하고, 수량을 변경하며, 장바구니를 비우는 전체 프로세스를 검증합니다.

---

## 시나리오 1: 장바구니 조회 및 확인

### 사용자 행동
1. 고객: "한우불고기버거 2개 주세요"
2. 봇: 장바구니에 추가 확인
3. 고객: "장바구니 확인해주세요"

### 예상 응답
```
장바구니 내역:
1. 한우불고기버거 x 2개 - 18,000원

총 금액: 18,000원
```

### 검증 포인트
- ✅ `getCartDetails` 함수가 올바르게 호출됨
- ✅ 상품명, 수량, 가격이 정확하게 표시됨
- ✅ 총 금액 계산이 올바름

---

## 시나리오 2: 장바구니에 여러 상품 추가 후 조회

### 사용자 행동
1. 고객: "한우불고기버거 세트 주세요"
2. 봇: 세트 메뉴 추가 확인
3. 고객: "감자튀김도 하나 더 추가요"
4. 봇: 감자튀김 추가 확인
5. 고객: "지금까지 뭐 담았죠?"

### 예상 응답
```
장바구니 내역:
1. 한우불고기버거 세트 x 1개 - 13,000원
   - 한우불고기버거
   - 포테이토 (미디움)
   - 콜라 (미디움)
2. 포테이토 (미디움) x 1개 - 2,000원

총 금액: 15,000원
```

### 검증 포인트
- ✅ 세트 메뉴와 단품이 함께 조회됨
- ✅ 세트 구성품이 그룹화되어 표시됨
- ✅ 총 금액이 정확함

---

## 시나리오 3: 장바구니 수량 변경

### 사용자 행동
1. 고객: "한우불고기버거 1개 주세요"
2. 봇: 장바구니에 추가
3. 고객: "아 한우불고기버거 3개로 바꿔주세요"

### 예상 응답
```
한우불고기버거 수량을 1개에서 3개로 변경했습니다.
총 금액: 27,000원
```

### 검증 포인트
- ✅ `updateCartItem` 함수가 올바르게 호출됨
- ✅ 수량이 정확하게 변경됨
- ✅ 총 금액이 재계산됨

---

## 시나리오 4: 특정 상품 삭제 (수량 0으로 변경)

### 사용자 행동
1. 고객: "한우불고기버거 2개, 콜라 1개 주세요"
2. 봇: 장바구니에 추가
3. 고객: "콜라는 빼주세요"

### 예상 응답
```
콜라 (미디움)를 장바구니에서 삭제했습니다.

현재 장바구니:
1. 한우불고기버거 x 2개 - 18,000원

총 금액: 18,000원
```

### 검증 포인트
- ✅ `updateCartItem(cart_item_id, 0)` 함수가 호출됨
- ✅ 해당 항목이 장바구니에서 삭제됨
- ✅ 다른 항목은 유지됨

---

## 시나리오 5: 장바구니 전체 비우기

### 사용자 행동
1. 고객: "한우불고기버거 2개, 감자튀김 1개 주세요"
2. 봇: 장바구니에 추가
3. 고객: "다시 생각해볼게요. 장바구니 비워주세요"

### 예상 응답
```
장바구니를 비웠습니다.
처음부터 다시 주문해주세요.
```

### 검증 포인트
- ✅ `clearCart` 함수가 호출됨
- ✅ 모든 항목이 삭제됨
- ✅ 이후 장바구니 조회 시 비어있음

---

## 시나리오 6: 빈 장바구니 조회

### 사용자 행동
1. 고객: "장바구니 확인해주세요"
   (아무것도 담지 않은 상태)

### 예상 응답
```
장바구니가 비어 있습니다.
메뉴를 선택해주세요!
```

### 검증 포인트
- ✅ `getCartDetails` 함수가 빈 결과 반환
- ✅ 적절한 안내 메시지 표시

---

## 시나리오 7: 세트 메뉴 수량 변경

### 사용자 행동
1. 고객: "한우불고기버거 세트 1개 주세요"
2. 봇: 세트 메뉴 추가 (구성품 3개)
3. 고객: "세트를 2개로 늘려주세요"

### 예상 응답
```
한우불고기버거 세트 수량을 1개에서 2개로 변경했습니다.

장바구니:
- 한우불고기버거 x 2개
- 포테이토 (미디움) x 2개
- 콜라 (미디움) x 2개

총 금액: 26,000원
```

### 검증 포인트
- ✅ 세트의 모든 구성품 수량이 함께 변경됨
- ✅ `set_group_id`로 묶인 항목들이 일괄 처리됨
- ✅ 총 금액이 정확하게 계산됨

---

## 시나리오 8: 주문 전 최종 확인

### 사용자 행동
1. 고객: "한우불고기버거 2개, 콜라 1개 주세요"
2. 봇: 장바구니에 추가
3. 고객: "주문할게요"
4. 봇: 최종 확인 요청

### 예상 응답
```
주문 내역을 확인해주세요:

1. 한우불고기버거 x 2개 - 18,000원
2. 콜라 (미디움) x 1개 - 2,000원

총 금액: 20,000원

이대로 주문하시겠습니까?
```

### 검증 포인트
- ✅ `getCartDetails` 함수로 최종 장바구니 조회
- ✅ 모든 항목이 정확하게 표시됨
- ✅ 주문 전 마지막 확인 단계

---

## 테스트 환경 설정

### 필요한 함수
- `getCartDetails(session_id)` - 장바구니 조회
- `updateCartItem(cart_item_id, quantity)` - 수량 변경
- `clearCart(session_id)` - 장바구니 비우기

### 데이터베이스 상태
- Products 테이블에 테스트 상품 데이터 존재
- Cart 테이블이 비어있는 상태에서 시작
- 각 시나리오마다 세션 초기화

---

## 성공 기준

1. **기능 완성도**
   - 모든 함수가 정상 동작
   - 에러 처리가 올바름
   - 반환값 형식이 일관됨

2. **사용자 경험**
   - 직관적인 메시지 표시
   - 가격 정보가 명확함
   - 세트/단품 구분이 명확함

3. **데이터 무결성**
   - 수량 변경이 정확함
   - 총 금액 계산이 정확함
   - 삭제 후 복구 불가 (의도된 동작)

---

## 주의사항

### 세트 메뉴 처리
- 현재 구조는 세트를 구성품별로 저장
- 총 금액은 구성품 가격의 합계 (할인 미적용)
- `set_group_id`로 세트 식별

### 수량 변경 로직
- 세트 메뉴 수량 변경 시 모든 구성품 일괄 변경 필요
- 단, 현재 `updateCartItem`은 개별 항목만 변경
- Sprint 4에서 세트 전체 수량 변경 로직 추가 고려

### 주문 완료
- Task 3.3에서는 장바구니 관리만 구현
- 실제 주문 생성은 Sprint 4의 Task 4.1에서 구현 예정
